<div class="note-container">
    @if(!isMobileScreen) {
    <div class="disktop-view" [ngClass]="{'collapse-section': isSectionCollapse}">
        <div class="note-section">
            <div class="note-section-header center-align-between">
                <h3>Section</h3>
                <div> <span class="material-symbols-outlined link"
                        (click)="isSectionCollapse = true">keyboard_double_arrow_left</span> </div>
            </div>
            <div class="note-section-container" #sectionScrollContainer>
                @for(section of sections; track section.sectionId; let i = $index) {
                <div class="note-section-item" [id]="'section_' + section.sectionId" (click)="onSelectSection(section)"
                    [ngClass]="{'selected': selectedSection?.sectionId === section.sectionId}">
                    <div><strong>{{ i + 1 }}.</strong></div>
                    <div [innerHTML]="section.name"></div>
                </div>
                }
            </div>
        </div>
        <div class="note-section-collapse" (click)="isSectionCollapse = false">
            <span class="material-symbols-outlined link section-expand">keyboard_double_arrow_left</span>
        </div>
        <div class="note-topic">
            <div class="note-topic-header">
                <h3>Content</h3>
            </div>
            <div class="note-topic-container" #contentScrollContainer>
                @let contents = selectedSection?.topics || [];
                @for(content of contents; track content.topicId; let i = $index) {
                <ng-container
                    *ngTemplateOutlet="activeNotesTableContent; context: { content: content, index: i }"></ng-container>
                }
                @let subSections = selectedSection?.subSections || [];
                @for(subSection of subSections; track subSection.subSectionId) {
                <div class="note-subsection-item">
                    <div class="note-subsection-title">Sub Section: </div>
                    <div class="note-subsection-text" [innerHTML]="subSection.name"></div>
                </div>
                @let contents = subSection?.topics || [];
                @for(content of contents; track content.topicId; let i = $index) {
                <ng-container
                    *ngTemplateOutlet="activeNotesTableContent; context: { content: content, index: i }"></ng-container>
                }
                }
            </div>
        </div>
        <div class="note-description">
            <app-description [topic]="selectedTopic" (emitEditorText)="onAddDescription($event)"></app-description>
        </div>
    </div>
    } @else {
    <div class="mobile-view">
        @for(section of sections; track section.sectionId) {
        <div class="note-section">
            <div class="note-section-item" (click)="onExpandSection(section.sectionId); $event.stopPropagation()">
                <div [innerHTML]="section.name"></div>
                <div>
                    <span class="material-symbols-outlined"> {{expandSections.includes(section.sectionId)?
                        'keyboard_arrow_up' : 'keyboard_arrow_down'}} </span>
                </div>
            </div>
            @if(expandSections.includes(section.sectionId)) {
            @for(content of section.topics; track content.topicId) {
            <ng-container *ngTemplateOutlet="activeNotesRowContent; context: { content: content }"></ng-container>
            }
            @for(subSection of section.subSections; track subSection.subSectionId) {
            <div class="note-sub-section">
                <div class="note-subsection-item" (click)="onExpandSubSection(subSection.subSectionId)">
                    <div [innerHTML]="subSection.name"></div>
                    <div><span class="material-symbols-outlined">{{expandSubSections.includes(subSection.subSectionId)?
                            'keyboard_arrow_up' : 'keyboard_arrow_down'}}</span></div>
                </div>
                @for(content of subSection.topics; track content.topicId) {
                @if(expandSubSections.includes(subSection.subSectionId)) {
                <ng-container *ngTemplateOutlet="activeNotesRowContent; context: { content: content }"></ng-container>
                }
                }
            </div>
            }
            }
        </div>

        }
    </div>
    }
</div>

<ng-template #activeNotesTableContent let-content="content" let-index="index">
    <div class="note-topic-item" [id]="'content_' + content.topicId" (click)="onSelectTopic(content)"
        [ngClass]="{'selected': selectedTopic?.topicId === content.topicId}">
        <div class="note-topic-index"><strong>{{ index + 1 }}.</strong></div>
        <div class="note-topic-content">
            <div [innerHTML]="content.text"></div>
            <span class="material-symbols-outlined" [pTooltip]="content.description? 'Answered' : 'Answer not added yet'" tooltipPosition="left"
                [ngClass]="{'status-icon-pending': !content.description, 'status-icon-ans': content.description}">{{content.description?
                'check_circle' : 'pending'}}</span>
        </div>
    </div>
</ng-template>

<ng-template #activeNotesRowContent let-content="content">
    <div class="note-topic">
        <div class="note-topic-item" (click)="onExpandTopic(content.topicId); $event.stopPropagation()">
            <div class="note-topic-content">
                <span class="material-symbols-outlined" [pTooltip]="content.description? 'Answered' : 'Answer not added yet'" tooltipPosition="left"
                    [ngClass]="{'status-icon-pending': !content.description, 'status-icon-ans': content.description}">{{content.description?
                    'check_circle' : 'pending'}}</span>
                <div [innerHTML]="content.text"></div>
            </div>
            <span class="material-symbols-outlined expand-icon"> {{expandTopics.includes(content.topicId)?
                'expand_circle_up' : 'expand_circle_down'}} </span>
        </div>
        @if(expandTopics.includes(content.topicId)) {
        @if(content.description) {
        <div class="note-description-item" [innerHTML]="content.description"></div>
        } @else {
        <div class="note-description-item">No Answer.</div>
        }
        }
    </div>
</ng-template>

<!-- @if(show) {
<app-text-editor-modal [header]="actions?.header" (closeModal)="onCloseModal($event)" />
} -->