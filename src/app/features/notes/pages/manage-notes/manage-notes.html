<div class="manage-notes-container" [ngClass]="{'manage-notes-action': selectedAction}">
    <div class="manage-notes" style="flex: 1;">
        <div class="manage-header">
            @if(sections.length > 0) {
            <p-select [options]="actions" (onChange)="onSelectAction($event)" optionLabel="name" placeholder="Select"
                class="w-full md:w-56" />
            } @else {
            <p-button class="ml-4" (click)="onSelectAction($event)" label="Add Section" severity="secondary" />
            }

            <p-button class="ml-4" (click)="onRearrange()" label="Rearrange" severity="secondary" />

        </div>
        <div class="manage-notes-content">
            @for(section of sections; track section.sectionId) {
            <div class="section-text center-align-between">
                <div [innerHTML]="section.name"></div>
                <div class="menu-container">
                    <span class="material-symbols-outlined link"
                        (click)="toggleMenu(section, 'section'); $event.stopPropagation()"> more_vert </span>
                    @if(openToggle === section.sectionId && toggleType === 'section') {
                    <ul class="menu-list">
                        <li (click)="addSection(section, '0')">Add Section Above</li>
                        <li (click)="addSection(section, '1')">Add Section Below</li>
                        <li (click)="editSection(section)">Edit Section</li>
                    </ul>
                    }
                </div>
            </div>
            @if(section?.topics?.length) {
            <ng-container *ngTemplateOutlet="myContent; context: { topics: section.topics }"></ng-container>
            }
            @if(section?.subSections?.length) {
            @for(subSection of section.subSections; track subSection.subSectionId) {
            <div class="subSection-text center-align-between">
                <div [innerHTML]="subSection.name"></div>
                <div class="menu-container">
                    <span class="material-symbols-outlined link"
                        (click)="toggleMenu(section, 'subSection'); $event.stopPropagation()"> more_vert </span>
                    @if(openToggle === section.sectionId && toggleType === 'subSection') {
                    <ul class="menu-list">
                        <li (click)="addSection(section, '0')">Add Sub Section Above</li>
                        <li (click)="addSection(section, '1')">Add Sub Section Below</li>
                        <li (click)="editSection(section)">Edit Sub Section</li>
                    </ul>
                    }
                </div>
            </div>
            @if(subSection?.topics?.length) {
            <ng-container *ngTemplateOutlet="myContent; context: { topics: subSection.topics }"></ng-container>
            }
            }
            }
            }
        </div>
    </div>
    <div class="manage-action-container">
        @if(selectedAction) {
        <app-manage-notes-form [action]="selectedAction" [notesForm]="notesForm" [sections]="sections"
            (closeManageNotesForm)="selectedAction = undefined"></app-manage-notes-form>
        }
    </div>
</div>

<ng-template #myContent let-topics="topics">
    @for(topic of topics; track topic.topicId) {
    <div class="content-text" [innerHTML]="topic.text"></div>
    }
</ng-template>